# Sentinel Configuration Example - GCP Pub/Sub
#
# This example demonstrates a production configuration using Google Cloud Pub/Sub
# as the message broker.
#
# Configure the broker using either:
#   1. broker.yaml file (see broker.yaml in project root)
#   2. BROKER_CONFIG_FILE environment variable pointing to your broker config
#   3. Direct environment variables:
#      BROKER_GOOGLEPUBSUB_PROJECT_ID=your-gcp-project-id
#
# For more details, see: https://github.com/openshift-hyperfleet/hyperfleet-broker

# Resource type to watch - must be one of: clusters, nodepools.
resource_type: clusters

# How often to poll the HyperFleet API for resource updates.
# Accepts Go duration format: ns, us/Âµs, ms, s, m, h.
poll_interval: 5s

# Max age interval for resources that are not ready.
# Resources in transitional states are re-checked more frequently.
max_age_not_ready: 10s

# Max age interval for resources that are ready and stable.
# Stable resources are checked less frequently to reduce API load.
max_age_ready: 30m

# Resource selector (optional) - filter resources by labels.
# If empty or omitted, all resources of the specified type are watched.
# This enables horizontal scaling by having multiple Sentinels watch different resource subsets.
# Multiple selectors use AND logic (all labels must match).
resource_selector:
  - label: shard
    value: "1"
  - label: region
    value: us-east-1

# HyperFleet API configuration.
hyperfleet_api:
  # API base URL (required).
  endpoint: http://hyperfleet-api.hyperfleet-system.svc.cluster.local:8080

  # Request timeout for API calls.
  timeout: 5s

# Message data template configuration (optional).
# Define custom fields to include in CloudEvents data payload.
# Uses Go template syntax - both .field and {{.field}} formats are supported.
# Templates can reference any field from the Resource object returned by the API.
message_data:
  resource_id: .id
  resource_type: .kind
  href: .href
  generation: .generation

# See broker.yaml for configuration options.
#
# Example Google Pub/Sub configuration in broker.yaml:
#   broker:
#     type: googlepubsub
#     googlepubsub:
#       project_id: your-gcp-project-id
#       max_outstanding_messages: 1000
#       num_goroutines: 10
#
# Or use environment variables:
#   BROKER_GOOGLEPUBSUB_PROJECT_ID=your-gcp-project-id
#
# Authentication uses Google Application Default Credentials (ADC):
# - In GKE: Uses Workload Identity.
# - Locally: Set GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json.
# - In Cloud Run/Cloud Functions: Uses the service's identity automatically.
