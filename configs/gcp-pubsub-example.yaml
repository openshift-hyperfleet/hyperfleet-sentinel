# Sentinel Configuration Example - GCP Pub/Sub
#
# This example demonstrates a production configuration using Google Cloud Pub/Sub
# as the message broker.
#
# Required environment variables:
#   BROKER_TYPE=pubsub
#   BROKER_PROJECT_ID=your-gcp-project-id
#
# Optional environment variables:
#   GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json

# Resource type to watch - must be one of: clusters, nodepools.
resource_type: clusters

# How often to poll the HyperFleet API for resource updates.
# Accepts Go duration format: ns, us/Âµs, ms, s, m, h.
poll_interval: 5s

# Backoff interval for resources that are not ready.
# Resources in transitional states are re-checked more frequently.
backoff_not_ready: 10s

# Backoff interval for resources that are ready and stable.
# Stable resources are checked less frequently to reduce API load.
backoff_ready: 30m

# Resource selector (optional) - filter resources by labels.
# If empty or omitted, all resources of the specified type are watched.
# This enables horizontal scaling by having multiple Sentinels watch different resource subsets.
# Multiple selectors use AND logic (all labels must match).
resource_selector:
  - label: shard
    value: "1"
  - label: region
    value: us-east-1

# HyperFleet API configuration.
hyperfleet_api:
  # API endpoint URL (required).
  endpoint: https://api.hyperfleet.production.example.com

  # Request timeout for API calls.
  timeout: 30s

# Message data template configuration (optional).
# Define custom fields to include in CloudEvents data payload.
# Uses Go template syntax - both .field and {{.field}} formats are supported.
# Templates can reference any field from the Resource object returned by the API.
message_data:
  resource_id: .id
  resource_type: .kind
  resource_name: .metadata.name
  cluster_region: .metadata.labels.region
  owner_id: .ownerResource.id
  generation: .generation
  reconciliation_status: .status.conditions[0].status

# Broker configuration is loaded from environment variables.
# For GCP Pub/Sub, set:
#   BROKER_TYPE=pubsub
#   BROKER_PROJECT_ID=your-gcp-project-id
#
# Authentication uses Google Application Default Credentials (ADC):
# - In GKE: Uses Workload Identity.
# - Locally: Set GOOGLE_APPLICATION_CREDENTIALS=/path/to/service-account-key.json.
# - In Cloud Run/Cloud Functions: Uses the service's identity automatically.
