# Sentinel Configuration Example - RabbitMQ
#
# This example demonstrates a production configuration using RabbitMQ
# as the message broker.
#
# Broker configuration is now managed by the hyperfleet-broker library.
# Configure the broker using either:
#   1. broker.yaml file (see broker.yaml in project root)
#   2. BROKER_CONFIG_FILE environment variable pointing to your broker config
#   3. Direct environment variables:
#      BROKER_RABBITMQ_URL=amqp://user:pass@rabbitmq.example.com:5672/vhost
#
# For more details, see: https://github.com/openshift-hyperfleet/hyperfleet-broker

# Resource type to watch - must be one of: clusters, nodepools.
resource_type: clusters

# How often to poll the HyperFleet API for resource updates.
# Accepts Go duration format: ns, us/Âµs, ms, s, m, h.
poll_interval: 5s

# Max age interval for resources that are not ready.
# Resources in transitional states are re-checked more frequently.
max_age_not_ready: 10s

# Max age interval for resources that are ready and stable.
# Stable resources are checked less frequently to reduce API load.
max_age_ready: 30m

# Resource selector (optional) - filter resources by labels.
# If empty or omitted, all resources of the specified type are watched.
# This enables horizontal scaling by having multiple Sentinels watch different resource subsets.
# Multiple selectors use AND logic (all labels must match).
resource_selector:
  - label: shard
    value: "1"
  - label: datacenter
    value: dc-east

# HyperFleet API configuration.
hyperfleet_api:
  # API base URL (required).
  endpoint: http://hyperfleet-api.hyperfleet-system.svc.cluster.local:8080

  # Request timeout for API calls.
  timeout: 5s

# Message data template configuration (optional).
# Define custom fields to include in CloudEvents data payload.
# Uses Go template syntax - both .field and {{.field}} formats are supported.
# Templates can reference any field from the Resource object returned by the API.
message_data:
  resource_id: .id
  resource_type: .kind
  href: .href
  generation: .generation

# Broker configuration is managed by the hyperfleet-broker library.
# See broker.yaml for configuration options.
#
# Example RabbitMQ configuration in broker.yaml:
#   broker:
#     type: rabbitmq
#     rabbitmq:
#       url: amqp://user:password@rabbitmq.hyperfleet-system.svc.cluster.local:5672/
#       exchange_type: topic
#
# Or use environment variables:
#   BROKER_RABBITMQ_URL=amqp://user:password@rabbitmq.hyperfleet-system.svc.cluster.local:5672/
#
# In Kubernetes, credentials should be provided via Secrets.
